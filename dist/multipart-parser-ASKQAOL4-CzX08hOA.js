const e=require(`./chunk-BwrM4yoD.js`),t=require(`./chunk-RXM4EBGR-DYjhbZ22.js`);var n=e.__commonJSMin(((exports,n)=>{var r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,o=Object.prototype.hasOwnProperty,s=(e,t)=>{for(var n in t)r(e,n,{get:t[n],enumerable:!0})},c=(e,t,n,s)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let c of a(t))!o.call(e,c)&&c!==n&&r(e,c,{get:()=>t[c],enumerable:!(s=i(t,c))||s.enumerable});return e},l=e=>c(r({},`__esModule`,{value:!0}),e),u={};s(u,{toFormData:()=>D}),n.exports=l(u);var d=t.require_chunk_RXM4EBGR();t.require_chunk_QGM4M3NI();var f=0,p={START_BOUNDARY:f++,HEADER_FIELD_START:f++,HEADER_FIELD:f++,HEADER_VALUE_START:f++,HEADER_VALUE:f++,HEADER_VALUE_ALMOST_DONE:f++,HEADERS_ALMOST_DONE:f++,PART_DATA_START:f++,PART_DATA:f++,END:f++},m=1,h={PART_BOUNDARY:m,LAST_BOUNDARY:m*=2},g=10,_=13,v=32,y=45,b=58,x=97,S=122,C=e=>e|32,w=()=>{},T=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=w,this.onHeaderField=w,this.onHeadersEnd=w,this.onHeaderValue=w,this.onPartBegin=w,this.onPartData=w,this.onPartEnd=w,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n),this.boundaryChars[t[n]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=p.START_BOUNDARY}write(e){let t=0,n=e.length,r=this.index,{lookbehind:i,boundary:a,boundaryChars:o,index:s,state:c,flags:l}=this,u=this.boundary.length,d=u-1,f=e.length,m,w,T=e=>{this[e+`Mark`]=t},E=e=>{delete this[e+`Mark`]},D=(e,t,n,r)=>{(t===void 0||t!==n)&&this[e](r&&r.subarray(t,n))},O=(n,r)=>{let i=n+`Mark`;i in this&&(r?(D(n,this[i],t,e),delete this[i]):(D(n,this[i],e.length,e),this[i]=0))};for(t=0;t<n;t++)switch(m=e[t],c){case p.START_BOUNDARY:if(s===a.length-2){if(m===y)l|=h.LAST_BOUNDARY;else if(m!==_)return;s++;break}else if(s-1==a.length-2){if(l&h.LAST_BOUNDARY&&m===y)c=p.END,l=0;else if(!(l&h.LAST_BOUNDARY)&&m===g)s=0,D(`onPartBegin`),c=p.HEADER_FIELD_START;else return;break}m!==a[s+2]&&(s=-2),m===a[s+2]&&s++;break;case p.HEADER_FIELD_START:c=p.HEADER_FIELD,T(`onHeaderField`),s=0;case p.HEADER_FIELD:if(m===_){E(`onHeaderField`),c=p.HEADERS_ALMOST_DONE;break}if(s++,m===y)break;if(m===b){if(s===1)return;O(`onHeaderField`,!0),c=p.HEADER_VALUE_START;break}if(w=C(m),w<x||w>S)return;break;case p.HEADER_VALUE_START:if(m===v)break;T(`onHeaderValue`),c=p.HEADER_VALUE;case p.HEADER_VALUE:m===_&&(O(`onHeaderValue`,!0),D(`onHeaderEnd`),c=p.HEADER_VALUE_ALMOST_DONE);break;case p.HEADER_VALUE_ALMOST_DONE:if(m!==g)return;c=p.HEADER_FIELD_START;break;case p.HEADERS_ALMOST_DONE:if(m!==g)return;D(`onHeadersEnd`),c=p.PART_DATA_START;break;case p.PART_DATA_START:c=p.PART_DATA,T(`onPartData`);case p.PART_DATA:if(r=s,s===0){for(t+=d;t<f&&!(e[t]in o);)t+=u;t-=d,m=e[t]}if(s<a.length)a[s]===m?(s===0&&O(`onPartData`,!0),s++):s=0;else if(s===a.length)s++,m===_?l|=h.PART_BOUNDARY:m===y?l|=h.LAST_BOUNDARY:s=0;else if(s-1===a.length)if(l&h.PART_BOUNDARY){if(s=0,m===g){l&=~h.PART_BOUNDARY,D(`onPartEnd`),D(`onPartBegin`),c=p.HEADER_FIELD_START;break}}else l&h.LAST_BOUNDARY&&m===y?(D(`onPartEnd`),c=p.END,l=0):s=0;if(s>0)i[s-1]=m;else if(r>0){let e=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);D(`onPartData`,0,r,e),r=0,T(`onPartData`),t--}break;case p.END:break;default:throw Error(`Unexpected state entered: ${c}`)}O(`onHeaderField`),O(`onHeaderValue`),O(`onPartData`),this.index=s,this.state=c,this.flags=l}end(){if(this.state===p.HEADER_FIELD_START&&this.index===0||this.state===p.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==p.END)throw Error(`MultipartParser.end(): stream ended unexpectedly`)}};function E(e){let t=e.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;let n=t[2]||t[3]||``,r=n.slice(n.lastIndexOf(`\\`)+1);return r=r.replace(/%22/g,`"`),r=r.replace(/&#(\d{4});/g,(e,t)=>String.fromCharCode(t)),r}async function D(e,t){if(!/multipart/i.test(t))throw TypeError(`Failed to fetch`);let n=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw TypeError(`no or bad content-type header, no multipart boundary`);let r=new T(n[1]||n[2]),i,a,o,s,c,l,u=[],f=new d.FormData,p=e=>{o+=_.decode(e,{stream:!0})},m=e=>{u.push(e)},h=()=>{let e=new d.file_default(u,l,{type:c});f.append(s,e)},g=()=>{f.append(s,o)},_=new TextDecoder(`utf-8`);_.decode(),r.onPartBegin=function(){r.onPartData=p,r.onPartEnd=g,i=``,a=``,o=``,s=``,c=``,l=null,u.length=0},r.onHeaderField=function(e){i+=_.decode(e,{stream:!0})},r.onHeaderValue=function(e){a+=_.decode(e,{stream:!0})},r.onHeaderEnd=function(){if(a+=_.decode(),i=i.toLowerCase(),i===`content-disposition`){let e=a.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);e&&(s=e[2]||e[3]||``),l=E(a),l&&(r.onPartData=m,r.onPartEnd=h)}else i===`content-type`&&(c=a);a=``,i=``};for await(let t of e)r.write(t);return r.end(),f}}));Object.defineProperty(exports,`default`,{enumerable:!0,get:function(){return n()}});
//# sourceMappingURL=multipart-parser-ASKQAOL4-CzX08hOA.js.map