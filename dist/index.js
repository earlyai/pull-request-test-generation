var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},c=(n,r,a)=>(a=n==null?{}:e(i(n)),s(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n));const l=c(require(`@actions/core`)),u=c(require(`@earlyai/core`)),d=c(require(`inversify`)),f=c(require(`@earlyai/ts-scout`)),p=c(require(`zod`)),m=c(require(`axios`)),h=c(require(`axios-retry`)),g=c(require(`node:child_process`)),ee=c(require(`node:util`)),te=c(require(`@actions/github`)),_={TsScoutService:Symbol.for(`TsScoutService`)},v={SIBLING_FOLDER:`siblingFolder`,ROOT_FOLDER:`rootFolder`},y={JEST:`jest`,MOCHA:`mocha`,VITEST:`vitest`},b={SPEC:`spec`,TEST:`test`},ne={CAMEL_CASE:`camelCase`,KEBAB_CASE:`kebabCase`},x={DEFAULT:0,MIN:0,MAX:100},S={DEFAULT:5,MIN:1,MAX:50},re=p.z.object({testStructure:p.z.string().default(`siblingFolder`).pipe(p.z.enum([v.SIBLING_FOLDER,v.ROOT_FOLDER])),testFramework:p.z.string().default(`jest`).pipe(p.z.enum([y.JEST,y.MOCHA,y.VITEST])),testSuffix:p.z.string().default(`spec`).pipe(p.z.enum([b.SPEC,b.TEST])),testFileName:p.z.string().default(`camelCase`).pipe(p.z.enum([ne.CAMEL_CASE,ne.KEBAB_CASE])),calculateCoverage:p.z.string().default(`on`).pipe(p.z.enum([`on`,`off`])),coverageThreshold:p.z.string().default(`0`).transform(e=>Number.parseInt(e,10)).pipe(p.z.number().min(x.MIN).max(x.MAX)),requestSource:p.z.literal(`CLI`),scoutConcurrency:p.z.string().default(`5`).transform(e=>Number.parseInt(e,10)).pipe(p.z.number().min(S.MIN).max(S.MAX)),backendURL:p.z.string().default(`https://api.startearly.ai`),secretToken:p.z.string().default(``),token:p.z.string()});var C=o(((exports,t)=>{function n(e,t){if(typeof Reflect==`object`&&typeof Reflect.metadata==`function`)return Reflect.metadata(e,t)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})),w=o(((exports,t)=>{function n(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})),T=c(C()),E=c(w());let D=class{config;constructor(){this.config=this.initializeConfig()}getConfig(){return this.config}getConfigValue(e){return this.config[e]}initializeConfig(){try{let e=this.getRawConfigFromInputs();l.setSecret(e.token),l.setSecret(e.secretToken);let t=re.parse(e);return l.info(`Configuration validated successfully`),l.debug(`Configuration: ${JSON.stringify(t,null,2)}`),t}catch(e){throw e instanceof Error?l.warning(`Configuration validation failed: ${e.message}`):l.warning(`Configuration validation failed with unknown error`),e}}getRawConfigFromInputs(){let e={testStructure:l.getInput(`test-structure`),testFramework:l.getInput(`test-framework`),testSuffix:l.getInput(`test-suffix`),testFileName:l.getInput(`test-file-name`),calculateCoverage:l.getInput(`calculate-coverage`),coverageThreshold:l.getInput(`coverage-threshold`),requestSource:`CLI`,scoutConcurrency:l.getInput(`scout-concurrency`),backendURL:l.getInput(`base-url`),secretToken:l.getInput(`apiKey`),token:l.getInput(`token`)||process.env.GITHUB_TOKEN};return Object.fromEntries(Object.entries(e).filter(([,e])=>!(0,u.isEmpty)(e)))}};D=(0,E.default)([(0,d.injectable)(`Singleton`),(0,T.default)(`design:paramtypes`,[])],D);const O=new d.Container({autobind:!0});O.bind(_.TsScoutService).toDynamicValue(async e=>{let t=e.get(D),n=(0,f.createTSScout)(t.getConfig());return await n.init(),n});const ie=p.z.object({id:p.z.number(),email:p.z.email(),firstName:p.z.string(),lastName:p.z.string(),subscription:p.z.object({planName:p.z.string(),planType:p.z.string()}),role:p.z.number(),quota:p.z.object({percent:p.z.number(),availableAmount:p.z.number(),initialLeftover:p.z.number(),limit:p.z.number()}),team:p.z.object({id:p.z.string(),name:p.z.string()}),roles:p.z.array(p.z.string())});var k=o(((exports,t)=>{function n(e,t){return function(n,r){t(n,r,e)}}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})),A=c(C()),j=c(k()),M=c(w()),N;let P=class{axiosInstance;configService;idToken;constructor(e){this.configService=e,this.axiosInstance=m.default.create({baseURL:this.configService.getConfigValue(`backendURL`),headers:{"Content-Type":`application/json`}}),(0,h.default)(this.axiosInstance,{retries:3,retryDelay:h.default.exponentialDelay,retryCondition:e=>m.default.isAxiosError(e)&&h.default.isNetworkOrIdempotentRequestError(e)||m.default.isAxiosError(e)&&e.response?.status!==void 0&&e.response.status>=500||!1})}async login(){let e=this.configService.getConfigValue(`secretToken`);if(!(0,u.isDefined)(e))throw Error(`API key is required but not configured`);try{let t=await this.axiosInstance.post(`auth/v2/sign-in-with-secret-token`,{secret:e});if((0,u.isDefined)(t.data.idToken))this.idToken=t.data.idToken;else throw Error(`Authentication response missing idToken`)}catch(e){if(m.default.isAxiosError(e)){if(e.response)throw Error(`Authentication failed: ${e.response.status} ${e.response.statusText}`);if((0,u.isDefined)(e.request))throw Error(`Authentication failed: No response received from server`)}throw Error(`Authentication failed: ${e instanceof Error?e.message:`Unknown error`}`)}}getAuthHeaders(){let e={"x-request-source":`CLI`};return(0,u.isDefined)(this.idToken)&&(e.authorization=`Bearer ${this.idToken}`),e}async apiCall({url:e,method:t,data:n,config:r}){let i=this.getAuthHeaders(),a=new m.AxiosHeaders(i);if(r?.headers)for(let[e,t]of Object.entries(r.headers))a.set(e,t);let o={...r,method:t,url:e,data:n,headers:a};try{return await this.axiosInstance.request(o)}catch(t){this.handleError(e,t)}}async get(e,t){let n=await this.apiCall({url:e,method:`GET`,config:t});return n.data}async post(e,t,n){let r=await this.apiCall({url:e,method:`POST`,data:t,config:n});return r.data}async put(e,t,n){let r=await this.apiCall({url:e,method:`PUT`,data:t,config:n});return r.data}async delete(e,t){let n=await this.apiCall({url:e,method:`DELETE`,config:t});return n.data}async patch(e,t,n){let r=await this.apiCall({url:e,method:`PATCH`,data:t,config:n});return r.data}async head(e,t){return this.apiCall({url:e,method:`HEAD`,config:t})}async options(e,t){return this.apiCall({url:e,method:`OPTIONS`,config:t})}handleError(e,t){if(m.default.isAxiosError(t))if((0,u.isDefined)(t.response)){let e=t.response,{status:n,statusText:r,data:i}=e;throw Error(`API request failed: ${n} ${r} - ${JSON.stringify(i)}`)}else if((0,u.isDefined)(t.request))throw Error(`API request failed: No response received from ${e}`);else throw Error(`API request failed: ${t instanceof Error?t.message:`Unknown error`}`);else if(t instanceof Error)throw TypeError(`API request failed: ${t.message}`);else throw TypeError(`API request failed: Unknown error occurred`)}async isAuthenticated(){return(0,u.isDefined)(this.idToken)}async getToken(){return this.idToken}getBaseUrl(){return this.configService.getConfigValue(`backendURL`)??`https://api.startearly.ai`}async getUserInfo(){let e=await this.get(`api/v1/user/me`);return ie.parse(e)}async logStartOperation(e,t){let n=this.configService.getConfig(),r=(0,u.isDefined)(process.env.GITHUB_SERVER_URL)&&(0,u.isDefined)(process.env.GITHUB_REPOSITORY)&&process.env.GITHUB_EVENT_NAME===`pull_request`&&(0,u.isDefined)(t?.prNumber)?`${process.env.GITHUB_SERVER_URL}/${process.env.GITHUB_REPOSITORY}/pull/${t.prNumber}`:void 0,i={type:`GENERATE_TESTS`,owner:e.owner,repo:e.repository,sourceRef:e.ref_name,commitSha:e.sha,threshold:n.coverageThreshold,testLocation:n.testStructure,testNaming:n.testFileName,operationStartedAt:new Date().toISOString(),prUrl:r},a=await this.post(`api/v1/workflows/open`,i);return a.id}async logEndOperation(e){let t={operationEndedAt:new Date().toISOString()};await this.patch(`api/v1/workflows/close/${e}`,t)}};P=(0,M.default)([(0,d.injectable)(),(0,j.default)(0,(0,d.inject)(D)),(0,A.default)(`design:paramtypes`,[typeof(N=D!==void 0&&D)==`function`?N:Object])],P);var F=c(w());let I=class{async analyzeChangedFiles(e,t,n){try{l.info(`Analyzing coverage for ${t.length} changed files with threshold ${n.coverageThreshold}%`);let r=[],i=0,a=0,o=0;for(let s of t){let t=this.normalizeFilePath(s),c=this.findFileCoverage(e,t);if(c){a++;let e=this.filterTestablesForFile(c,s,n);r.push(...e),i+=c.testables?.length??0,e.length>0&&l.debug(`File ${s}: ${e.length}/${c.testables?.length??0} testables below threshold`)}else o++,l.debug(`No coverage data found for file: ${s}`)}let s={testables:r,totalAnalyzed:i,filteredCount:r.length,filesWithCoverage:a,filesWithoutCoverage:o};return l.info(`Coverage analysis complete: ${s.filteredCount}/${s.totalAnalyzed} testables below threshold across ${s.filesWithCoverage} files`),s.filesWithoutCoverage>0&&l.warning(`${s.filesWithoutCoverage} changed files have no coverage data`),s}catch(e){throw e instanceof Error?(l.error(`Failed to analyze coverage: ${e.message}`),e):Error(`Unknown error occurred while analyzing coverage`)}}normalizeFilePath(e){return e.startsWith(`/`)?e.slice(1):e}findFileCoverage(e,t){if((0,u.isDefined)(e[t]))return e[t];let n=`/${t}`;if((0,u.isDefined)(e[n]))return e[n];for(let[n,r]of Object.entries(e))if(n.toLowerCase()===t.toLowerCase())return r;return null}filterTestablesForFile(e,t,n){let r=[];for(let i of e.testables??[]){let e=this.shouldIncludeTestable(i,n);if(e){let e=this.getFilterReason(i);r.push({name:i.name,percentage:i.percentage,filePath:t,reason:e})}}return r}shouldIncludeTestable(e,t){return!!(e.percentage===null||e.percentage===0||(0,u.isDefined)(e.percentage)&&e.percentage<t.coverageThreshold)}getFilterReason(e){return e.percentage===null?`no-coverage`:e.percentage===0?`zero-coverage`:`below-threshold`}};I=(0,F.default)([(0,d.injectable)()],I);var ae=c(w());const L=(0,ee.promisify)(g.exec);let R=class{async getGitInfo(){try{let e=await this.getLocalGitInfo();return e}catch(e){l.warning(`Failed to get local Git info: ${e instanceof Error?e.message:`Unknown error`}`);try{let e=this.getContextInfo();return l.warning(`Using GitHub Actions context as fallback for Git information`),e}catch(e){return l.warning(`Failed to get context info: ${e instanceof Error?e.message:`Unknown error`}`),{ref_name:``,repository:``,owner:``,sha:``}}}}async getLocalGitInfo(){let[e,t,n]=await Promise.all([this.getRefName(),this.getSha(),this.getRemoteUrl()]),{owner:r,repository:i}=this.parseRemoteUrl(n);return{ref_name:e,repository:i,owner:r,sha:t}}async getRefName(){try{let{stdout:e}=await L(`git rev-parse --abbrev-ref HEAD`);return e.trim()}catch{return l.warning(`Could not get ref_name from local Git`),``}}async getSha(){try{let{stdout:e}=await L(`git rev-parse HEAD`);return e.trim()}catch{return l.warning(`Could not get SHA from local Git`),``}}async getRemoteUrl(){try{let{stdout:e}=await L(`git remote get-url origin`);return e.trim()}catch{return l.warning(`Could not get remote URL from local Git`),``}}parseRemoteUrl(e){if(!e)return{owner:``,repository:``};try{if(e.startsWith(`https://`)){let t=new URL(e),n=t.pathname.split(`/`).filter(Boolean);if(n.length>=2)return{owner:n[0],repository:n[1].replace(`.git`,``)}}if(e.includes(`@`)&&e.includes(`:`)){let t=e.split(`:`);if(t.length===2){let e=t[1].split(`/`).filter(Boolean);if(e.length>=2)return{owner:e[0],repository:e[1].replace(`.git`,``)}}}return{owner:``,repository:``}}catch{return l.warning(`Failed to parse remote URL: ${e}`),{owner:``,repository:``}}}getContextInfo(){let e=process.env.GITHUB_REF_NAME??``,t=process.env.GITHUB_REPOSITORY??``,n=process.env.GITHUB_SHA??``,[r,i]=t.split(`/`),a=i||``;return{ref_name:e,repository:a,owner:r||``,sha:n}}};R=(0,ae.default)([(0,d.injectable)()],R);const z={allowedExtensions:[`.ts`,`.tsx`,`.js`,`.jsx`],excludePatterns:[`test`,`spec`,`.test.`,`.spec.`,`.test.ts`,`.spec.ts`,`.test.tsx`,`.spec.tsx`,`.test.js`,`.spec.js`,`.test.jsx`,`.spec.jsx`]};var B=c(C()),V=c(k()),H=c(w()),U;let W=class{octokit;context;constructor(e){this.configService=e;let t=this.configService.getConfigValue(`token`)??process.env.GITHUB_TOKEN;if(!(0,u.isDefined)(t))throw Error(`GitHub token is required. Set GITHUB_TOKEN environment variable or configure token in settings.`);this.octokit=te.getOctokit(t),this.context=te.context}isPullRequestContext(){return this.context.eventName===`pull_request`}getPullRequestNumber(){if(!this.isPullRequestContext())return null;let e=this.context.payload.pull_request?.number;return typeof e==`number`?e:null}async getChangedFiles(e){try{if(!this.isPullRequestContext())throw Error(`Not running in pull request context`);let t=this.getPullRequestNumber();if(!(0,u.isDefined)(t))throw Error(`Unable to determine pull request number`);l.info(`Retrieving changed files for pull request #${t}`);let n=await this.retrieveChangedFiles(t),r=this.filterFiles(n,e),i={files:r,totalProcessed:n.length,filteredCount:r.length};return l.info(`Processed ${i.totalProcessed} changed files, filtered to ${i.filteredCount} relevant files`),i}catch(e){throw e instanceof Error?(l.error(`Failed to get changed files: ${e.message}`),e):Error(`Unknown error occurred while getting changed files`)}}async retrieveChangedFiles(e){try{let t=await this.octokit.rest.pulls.listFiles({owner:this.context.repo.owner,repo:this.context.repo.repo,pull_number:e,per_page:100});if(t.status!==200)throw Error(`GitHub API returned status ${t.status}`);return t.data.map(e=>({path:e.filename,status:e.status,sha:e.sha,filename:e.filename.split(`/`).pop()??e.filename}))}catch(e){throw e instanceof Error?(e.message.includes(`rate limit`)&&l.warning(`GitHub API rate limit exceeded, consider using a token with higher limits`),Error(`Failed to retrieve changed files: ${e.message}`)):Error(`Unknown error occurred while retrieving changed files`)}}filterFiles(e,t){let n={...z,...t};return e.filter(e=>{let t=n.allowedExtensions.some(t=>e.path.toLowerCase().endsWith(t));if(!t)return!1;let r=n.excludePatterns.some(t=>e.path.toLowerCase().includes(t.toLowerCase()));return!r}).map(e=>e.path)}};W=(0,H.default)([(0,d.injectable)(),(0,V.default)(0,(0,d.inject)(D)),(0,B.default)(`design:paramtypes`,[typeof(U=D!==void 0&&D)==`function`?U:Object])],W);var G=c(C()),K=c(k()),q=c(w()),J;let Y=class{constructor(e){this.githubService=e}async getChangedFilesFromPR(){try{if(this.shouldUseMockData())return l.info(`Using mock data for changed files (ACTIONS_STEP_DEBUG=true)`),this.getMockChangedFiles();if(!this.githubService.isPullRequestContext())return{success:!1,error:`Not running in pull request context`,isMock:!1};let e=this.githubService.getPullRequestNumber();if(!(0,u.isDefined)(e))return{success:!1,error:`Unable to determine pull request number`,isMock:!1};l.info(`Running in pull request context: #${e}`);let t=await this.githubService.getChangedFiles();return l.info(`Found ${t.totalProcessed} changed files, ${t.filteredCount} relevant files`),{success:!0,data:t,isMock:!1,prNumber:e}}catch(e){let t=e instanceof Error?e.message:`Unknown error occurred`;return l.warning(`Failed to get changed files: ${t}`),{success:!1,error:t,isMock:!1}}}shouldUseMockData(){return process.env.ACTIONS_STEP_DEBUG===`true`}getMockChangedFiles(){let e=[`src/main.ts`,`src/services/config/config.service.ts`],t={files:e,totalProcessed:e.length,filteredCount:e.length};return l.debug(`Mock changed files: ${JSON.stringify(t,null,2)}`),{success:!0,data:t,isMock:!0,prNumber:123}}};Y=(0,q.default)([(0,d.injectable)(),(0,K.default)(0,(0,d.inject)(W)),(0,G.default)(`design:paramtypes`,[typeof(J=W!==void 0&&W)==`function`?J:Object])],Y);var X=c(C()),Z=c(k()),oe=c(w()),se,ce,Q,le,ue,de;let $=class{constructor(e,t,n,r,i,a,o){this.configService=e,this.apiService=t,this.gitService=n,this.coverageAnalysisService=r,this.changedFilesService=i,this.githubService=a,this.scoutService=o}async runPRContextFlow(){try{await this.loginAndLogStart(),await this.generateInitialCoverage();let e=await this.analyzeChangedFiles();(0,u.isEmpty)(e)?l.warning(`No filtered testables result`):l.info(`Filtered testables result count: ${e.length}`),await this.generateTests(e),await this.generateFinalCoverageAndLog()}catch(e){throw l.error(`Agent flow failed: ${e instanceof Error?e.message:`Unknown error`}`),e}finally{await this.logEndOperation()}}async loginAndLogStart(){try{await this.apiService.login(),l.info(`Successfully authenticated with the API`);let e=await this.gitService.getGitInfo(),t=this.githubService.getPullRequestNumber();if((0,u.isDefined)(t)){let n=await this.apiService.logStartOperation(e,{prNumber:t});l.info(`Successfully logged workflow start`),this.workflowRunId=n}else{let t=await this.apiService.logStartOperation(e);l.info(`Successfully logged workflow start`),this.workflowRunId=t}}catch(e){l.warning(`Failed to authenticate or log workflow start: `+(e instanceof Error?e.message:`Unknown error`))}}async generateInitialCoverage(){l.info(`Generating initial coverage...`),await this.scoutService.generateCoverage();let e=await this.scoutService.getCoverageTree();if(!e)throw Error(`Failed to generate initial coverage tree`);this.initialCoverage=e[`/`]?.percentage??void 0,l.setOutput(`pre-coverage`,this.initialCoverage),l.info(`Initial coverage: ${this.initialCoverage}%`)}async analyzeChangedFiles(){let e=l.getInput(`token`)||process.env.GITHUB_TOKEN;if(!(0,u.isDefined)(e))return l.info(`No GitHub token available, skipping changed files analysis`),[];try{let e=await this.changedFilesService.getChangedFilesFromPR();if(e.success&&e.data){let{data:t}=e;l.info(`PR Context: PR #${e.prNumber}`);let n=this.configService.getConfig(),r=await this.scoutService.getCoverageTree();if(!r)throw Error(`Failed to get coverage tree for analysis`);let i=await this.coverageAnalysisService.analyzeChangedFiles(r,t.files,{coverageThreshold:n.coverageThreshold});l.debug(`Changed files: ${JSON.stringify(t.files,null,2)}`),l.debug(`Coverage analysis: ${JSON.stringify(i,null,2)}`);let a=[];for(let e of t.files){l.debug(`Getting testables for file: ${e}`);let t=await this.scoutService.getTestables(e);a.push(...t)}let o=new Map;for(let e of i.testables){let t=e.filePath.startsWith(`/`)?e.filePath:`/${e.filePath}`;o.has(t)||o.set(t,new Set);let n=o.get(t);(0,u.isDefined)(n)&&n.add(e.name)}l.debug(`Filtered testables map: ${JSON.stringify(o,null,2)}`);let s=[];for(let[e,t]of a){let n=o.get(e);if(n)for(let r of t)n.has(r.name??``)&&s.push({filePath:e,testable:r})}return s}else return(0,u.isDefined)(e.error)&&(e.error.includes(`Not running in pull request context`)?l.info(`Not running in pull request context, skipping file analysis`):l.warning(`Failed to get changed files: ${e.error}`)),[]}catch(e){return l.warning(`Error analyzing changed files: ${e instanceof Error?e.message:`Unknown error`}`),[]}}async generateTests(e){return this.scoutService.bulkGenerateTests(e)}async generateFinalCoverageAndLog(){l.info(`Generating final coverage...`),await this.scoutService.generateCoverage();let e=await this.scoutService.getCoverageTree();if(!e)throw Error(`Failed to generate final coverage tree`);let t=e[`/`]?.percentage;l.setOutput(`post-coverage`,t),this.initialCoverage===void 0?l.info(`Final coverage: ${t}%`):l.info(`Coverage comparison: ${this.initialCoverage}% → ${t}%`)}async logEndOperation(){if((0,u.isDefined)(this.workflowRunId))try{await this.apiService.logEndOperation(this.workflowRunId),l.info(`Successfully logged workflow end`)}catch(e){l.warning(`Failed to log workflow end: ${e instanceof Error?e.message:`Unknown error`}`)}}workflowRunId;initialCoverage};$=(0,oe.default)([(0,d.injectable)(),(0,Z.default)(0,(0,d.inject)(D)),(0,Z.default)(1,(0,d.inject)(P)),(0,Z.default)(2,(0,d.inject)(R)),(0,Z.default)(3,(0,d.inject)(I)),(0,Z.default)(4,(0,d.inject)(Y)),(0,Z.default)(5,(0,d.inject)(W)),(0,Z.default)(6,(0,d.inject)(_.TsScoutService)),(0,X.default)(`design:paramtypes`,[typeof(se=D!==void 0&&D)==`function`?se:Object,typeof(ce=P!==void 0&&P)==`function`?ce:Object,typeof(Q=R!==void 0&&R)==`function`?Q:Object,typeof(le=I!==void 0&&I)==`function`?le:Object,typeof(ue=Y!==void 0&&Y)==`function`?ue:Object,typeof(de=W!==void 0&&W)==`function`?de:Object,Object])],$);var fe=o((()=>{
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var e;(function(e){(function(t){var n=typeof globalThis==`object`?globalThis:typeof global==`object`?global:typeof self==`object`?self:typeof this==`object`?this:s(),r=i(e);n.Reflect!==void 0&&(r=i(n.Reflect,r)),t(r,n),n.Reflect===void 0&&(n.Reflect=e);function i(e,t){return function(n,r){Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}function a(){try{return Function(`return this;`)()}catch(e){}}function o(){try{return(0,eval)(`(function() { return this; })()`)}catch(e){}}function s(){return a()||o()}})(function(e,t){var n=Object.prototype.hasOwnProperty,r=typeof Symbol==`function`,i=r&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:`@@toPrimitive`,a=r&&Symbol.iterator!==void 0?Symbol.iterator:`@@iterator`,o=typeof Object.create==`function`,s={__proto__:[]}instanceof Array,c=!o&&!s,l={create:o?function(){return $(Object.create(null))}:s?function(){return $({__proto__:null})}:function(){return $({})},has:c?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),d=typeof Map==`function`&&typeof Map.prototype.entries==`function`?Map:le(),f=typeof Set==`function`&&typeof Set.prototype.entries==`function`?Set:ue(),p=typeof WeakMap==`function`?WeakMap:de(),m=r?Symbol.for(`@reflect-metadata:registry`):void 0,h=oe(),g=se(h);function ee(e,t,n,r){if(M(n)){if(!B(e)||!H(t))throw TypeError();return C(e,t)}else{if(!B(e)||!F(t)||!F(r)&&!M(r)&&!N(r))throw TypeError();return N(r)&&(r=void 0),n=z(n),w(e,t,n,r)}}e(`decorate`,ee);function te(e,t){function n(n,r){if(!F(n)||!M(r)&&!U(r))throw TypeError();ie(e,t,n,r)}return n}e(`metadata`,te);function _(e,t,n,r){if(!F(n))throw TypeError();return M(r)||(r=z(r)),ie(e,t,n,r)}e(`defineMetadata`,_);function v(e,t,n){if(!F(t))throw TypeError();return M(n)||(n=z(n)),T(e,t,n)}e(`hasMetadata`,v);function y(e,t,n){if(!F(t))throw TypeError();return M(n)||(n=z(n)),E(e,t,n)}e(`hasOwnMetadata`,y);function b(e,t,n){if(!F(t))throw TypeError();return M(n)||(n=z(n)),D(e,t,n)}e(`getMetadata`,b);function ne(e,t,n){if(!F(t))throw TypeError();return M(n)||(n=z(n)),O(e,t,n)}e(`getOwnMetadata`,ne);function x(e,t){if(!F(e))throw TypeError();return M(t)||(t=z(t)),k(e,t)}e(`getMetadataKeys`,x);function S(e,t){if(!F(e))throw TypeError();return M(t)||(t=z(t)),A(e,t)}e(`getOwnMetadataKeys`,S);function re(e,t,n){if(!F(t)||(M(n)||(n=z(n)),!F(t)))throw TypeError();M(n)||(n=z(n));var r=Q(t,n,!1);return M(r)?!1:r.OrdinaryDeleteMetadata(e,t,n)}e(`deleteMetadata`,re);function C(e,t){for(var n=e.length-1;n>=0;--n){var r=e[n],i=r(t);if(!M(i)&&!N(i)){if(!H(i))throw TypeError();t=i}}return t}function w(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=e[i],o=a(t,n,r);if(!M(o)&&!N(o)){if(!F(o))throw TypeError();r=o}}return r}function T(e,t,n){var r=E(e,t,n);if(r)return!0;var i=X(t);return N(i)?!1:T(e,i,n)}function E(e,t,n){var r=Q(t,n,!1);return M(r)?!1:L(r.OrdinaryHasOwnMetadata(e,t,n))}function D(e,t,n){var r=E(e,t,n);if(r)return O(e,t,n);var i=X(t);if(!N(i))return D(e,i,n)}function O(e,t,n){var r=Q(t,n,!1);if(!M(r))return r.OrdinaryGetOwnMetadata(e,t,n)}function ie(e,t,n,r){var i=Q(n,r,!0);i.OrdinaryDefineOwnMetadata(e,t,n,r)}function k(e,t){var n=A(e,t),r=X(e);if(r===null)return n;var i=k(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var a=new f,o=[],s=0,c=n;s<c.length;s++){var l=c[s],u=a.has(l);u||(a.add(l),o.push(l))}for(var d=0,p=i;d<p.length;d++){var l=p[d],u=a.has(l);u||(a.add(l),o.push(l))}return o}function A(e,t){var n=Q(e,t,!1);return n?n.OrdinaryOwnMetadataKeys(e,t):[]}function j(e){if(e===null)return 1;switch(typeof e){case`undefined`:return 0;case`boolean`:return 2;case`string`:return 3;case`symbol`:return 4;case`number`:return 5;case`object`:return e===null?1:6;default:return 6}}function M(e){return e===void 0}function N(e){return e===null}function P(e){return typeof e==`symbol`}function F(e){return typeof e==`object`?e!==null:typeof e==`function`}function I(e,t){switch(j(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var n=t===3?`string`:t===5?`number`:`default`,r=G(e,i);if(r!==void 0){var a=r.call(e,n);if(F(a))throw TypeError();return a}return ae(e,n===`default`?`number`:n)}function ae(e,t){if(t===`string`){var n=e.toString;if(V(n)){var r=n.call(e);if(!F(r))return r}var i=e.valueOf;if(V(i)){var r=i.call(e);if(!F(r))return r}}else{var i=e.valueOf;if(V(i)){var r=i.call(e);if(!F(r))return r}var a=e.toString;if(V(a)){var r=a.call(e);if(!F(r))return r}}throw TypeError()}function L(e){return!!e}function R(e){return``+e}function z(e){var t=I(e,3);return P(t)?t:R(t)}function B(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)===`[object Array]`}function V(e){return typeof e==`function`}function H(e){return typeof e==`function`}function U(e){switch(j(e)){case 3:return!0;case 4:return!0;default:return!1}}function W(e,t){return e===t||e!==e&&t!==t}function G(e,t){var n=e[t];if(n!=null){if(!V(n))throw TypeError();return n}}function K(e){var t=G(e,a);if(!V(t))throw TypeError();var n=t.call(e);if(!F(n))throw TypeError();return n}function q(e){return e.value}function J(e){var t=e.next();return t.done?!1:t}function Y(e){var t=e.return;t&&t.call(e)}function X(e){var t=Object.getPrototypeOf(e);if(typeof e!=`function`||e===u||t!==u)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(r==null||r===Object.prototype)return t;var i=r.constructor;return typeof i!=`function`||i===e?t:i}function Z(){var e;!M(m)&&t.Reflect!==void 0&&!(m in t.Reflect)&&typeof t.Reflect.defineMetadata==`function`&&(e=ce(t.Reflect));var n,r,i,a=new p,o={registerProvider:s,getProvider:l,setProvider:h};return o;function s(t){if(!Object.isExtensible(o))throw Error(`Cannot add provider to a frozen registry.`);switch(!0){case e===t:break;case M(n):n=t;break;case n===t:break;case M(r):r=t;break;case r===t:break;default:i===void 0&&(i=new f),i.add(t);break}}function c(t,a){if(!M(n)){if(n.isProviderFor(t,a))return n;if(!M(r)){if(r.isProviderFor(t,a))return n;if(!M(i))for(var o=K(i);;){var s=J(o);if(!s)return;var c=q(s);if(c.isProviderFor(t,a))return Y(o),c}}}if(!M(e)&&e.isProviderFor(t,a))return e}function l(e,t){var n=a.get(e),r;return M(n)||(r=n.get(t)),M(r)?(r=c(e,t),M(r)||(M(n)&&(n=new d,a.set(e,n)),n.set(t,r)),r):r}function u(e){if(M(e))throw TypeError();return n===e||r===e||!M(i)&&i.has(e)}function h(e,t,n){if(!u(n))throw Error(`Metadata provider not registered.`);var r=l(e,t);if(r!==n){if(!M(r))return!1;var i=a.get(e);M(i)&&(i=new d,a.set(e,i)),i.set(t,n)}return!0}}function oe(){var e;return!M(m)&&F(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[m]),M(e)&&(e=Z()),!M(m)&&F(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,m,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function se(e){var t=new p,n={isProviderFor:function(e,n){var r=t.get(e);return M(r)?!1:r.has(n)},OrdinaryDefineOwnMetadata:o,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:a,OrdinaryOwnMetadataKeys:s,OrdinaryDeleteMetadata:c};return h.registerProvider(n),n;function r(r,i,a){var o=t.get(r),s=!1;if(M(o)){if(!a)return;o=new d,t.set(r,o),s=!0}var c=o.get(i);if(M(c)){if(!a)return;if(c=new d,o.set(i,c),!e.setProvider(r,i,n))throw o.delete(i),s&&t.delete(r),Error(`Wrong provider for target.`)}return c}function i(e,t,n){var i=r(t,n,!1);return M(i)?!1:L(i.has(e))}function a(e,t,n){var i=r(t,n,!1);if(!M(i))return i.get(e)}function o(e,t,n,i){var a=r(n,i,!0);a.set(e,t)}function s(e,t){var n=[],i=r(e,t,!1);if(M(i))return n;for(var a=i.keys(),o=K(a),s=0;;){var c=J(o);if(!c)return n.length=s,n;var l=q(c);try{n[s]=l}catch(e){try{Y(o)}finally{throw e}}s++}}function c(e,n,i){var a=r(n,i,!1);if(M(a)||!a.delete(e))return!1;if(a.size===0){var o=t.get(n);M(o)||(o.delete(i),o.size===0&&t.delete(o))}return!0}}function ce(e){var t=e.defineMetadata,n=e.hasOwnMetadata,r=e.getOwnMetadata,i=e.getOwnMetadataKeys,a=e.deleteMetadata,o=new p,s={isProviderFor:function(e,t){var n=o.get(e);return!M(n)&&n.has(t)?!0:i(e,t).length?(M(n)&&(n=new f,o.set(e,n)),n.add(t),!0):!1},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:r,OrdinaryOwnMetadataKeys:i,OrdinaryDeleteMetadata:a};return s}function Q(e,t,n){var r=h.getProvider(e,t);if(!M(r))return r;if(n){if(h.setProvider(e,t,g))return g;throw Error(`Illegal state.`)}}function le(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype[`@@iterator`]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}(),r=function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,`size`,{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,W(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,i)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype[`@@iterator`]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){if(!W(this._cacheKey,e)){this._cacheIndex=-1;for(var n=0;n<this._keys.length;n++)if(W(this._keys[n],e)){this._cacheIndex=n;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();return r;function i(e,t){return e}function o(e,t){return t}function s(e,t){return[e,t]}}function ue(){var e=function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,`size`,{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype[`@@iterator`]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}();return e}function de(){var e=16,t=l.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=a(e,!1);return t===void 0?!1:l.has(t,this._key)},e.prototype.get=function(e){var t=a(e,!1);return t===void 0?void 0:l.get(t,this._key)},e.prototype.set=function(e,t){var n=a(e,!0);return n[this._key]=t,this},e.prototype.delete=function(e){var t=a(e,!1);return t===void 0?!1:delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do e=`@@WeakMap@@`+c();while(l.has(t,e));return t[e]=!0,e}function a(e,t){if(!n.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:l.create()})}return e[r]}function o(e,t){for(var n=0;n<t;++n)e[n]=Math.random()*255|0;return e}function s(e){if(typeof Uint8Array==`function`){var t=new Uint8Array(e);return typeof crypto<`u`?crypto.getRandomValues(t):typeof msCrypto<`u`?msCrypto.getRandomValues(t):o(t,e),t}return o(Array(e),e)}function c(){var t=s(e);t[6]=t[6]&79|64,t[8]=t[8]&191|128;for(var n=``,r=0;r<e;++r){var i=t[r];(r===4||r===6||r===8)&&(n+=`-`),i<16&&(n+=`0`),n+=i.toString(16).toLowerCase()}return n}}function $(e){return e.__=void 0,delete e.__,e}})})(e||(e={}))})),pe=c(fe());async function me(){try{let e=l.getInput(`token`)??process.env.GITHUB_TOKEN;if(!(0,u.isDefined)(e))throw Error(`GITHUB_TOKEN is required but not set`);let t=await O.getAsync($);await t.runPRContextFlow()}catch(e){e instanceof Error&&l.setFailed(e.message)}}me();
//# sourceMappingURL=index.js.map