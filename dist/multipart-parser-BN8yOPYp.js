const e=require(`./chunk-BwrM4yoD.js`),t=require(`./node-CJ1TQnzm.js`);var n=e.__commonJSMin((exports=>{var n=Object.defineProperty,r=(e,t)=>n(e,`name`,{value:t,configurable:!0});let i=t.require_node();require(`node:http`),require(`node:https`),require(`node:zlib`),require(`node:stream`),require(`node:buffer`),require(`node:util`),t.require_node_fetch_native_DhEqb06g(),require(`node:url`),require(`node:net`),require(`node:fs`),require(`node:path`);let a=0,o={START_BOUNDARY:a++,HEADER_FIELD_START:a++,HEADER_FIELD:a++,HEADER_VALUE_START:a++,HEADER_VALUE:a++,HEADER_VALUE_ALMOST_DONE:a++,HEADERS_ALMOST_DONE:a++,PART_DATA_START:a++,PART_DATA:a++,END:a++},s=1,c={PART_BOUNDARY:s,LAST_BOUNDARY:s*=2},l=r(e=>e|32,`lower`),u=r(()=>{},`noop`),d=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=u,this.onHeaderField=u,this.onHeadersEnd=u,this.onHeaderValue=u,this.onPartBegin=u,this.onPartData=u,this.onPartEnd=u,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n),this.boundaryChars[t[n]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=o.START_BOUNDARY}write(e){let t=0,n=e.length,i=this.index,{lookbehind:a,boundary:s,boundaryChars:u,index:d,state:f,flags:p}=this,m=this.boundary.length,h=m-1,g=e.length,_,v,y=r(e=>{this[e+`Mark`]=t},`mark`),b=r(e=>{delete this[e+`Mark`]},`clear`),x=r((e,t,n,r)=>{(t===void 0||t!==n)&&this[e](r&&r.subarray(t,n))},`callback`),S=r((n,r)=>{let i=n+`Mark`;i in this&&(r?(x(n,this[i],t,e),delete this[i]):(x(n,this[i],e.length,e),this[i]=0))},`dataCallback`);for(t=0;t<n;t++)switch(_=e[t],f){case o.START_BOUNDARY:if(d===s.length-2){if(_===45)p|=c.LAST_BOUNDARY;else if(_!==13)return;d++;break}else if(d-1==s.length-2){if(p&c.LAST_BOUNDARY&&_===45)f=o.END,p=0;else if(!(p&c.LAST_BOUNDARY)&&_===10)d=0,x(`onPartBegin`),f=o.HEADER_FIELD_START;else return;break}_!==s[d+2]&&(d=-2),_===s[d+2]&&d++;break;case o.HEADER_FIELD_START:f=o.HEADER_FIELD,y(`onHeaderField`),d=0;case o.HEADER_FIELD:if(_===13){b(`onHeaderField`),f=o.HEADERS_ALMOST_DONE;break}if(d++,_===45)break;if(_===58){if(d===1)return;S(`onHeaderField`,!0),f=o.HEADER_VALUE_START;break}if(v=l(_),v<97||v>122)return;break;case o.HEADER_VALUE_START:if(_===32)break;y(`onHeaderValue`),f=o.HEADER_VALUE;case o.HEADER_VALUE:_===13&&(S(`onHeaderValue`,!0),x(`onHeaderEnd`),f=o.HEADER_VALUE_ALMOST_DONE);break;case o.HEADER_VALUE_ALMOST_DONE:if(_!==10)return;f=o.HEADER_FIELD_START;break;case o.HEADERS_ALMOST_DONE:if(_!==10)return;x(`onHeadersEnd`),f=o.PART_DATA_START;break;case o.PART_DATA_START:f=o.PART_DATA,y(`onPartData`);case o.PART_DATA:if(i=d,d===0){for(t+=h;t<g&&!(e[t]in u);)t+=m;t-=h,_=e[t]}if(d<s.length)s[d]===_?(d===0&&S(`onPartData`,!0),d++):d=0;else if(d===s.length)d++,_===13?p|=c.PART_BOUNDARY:_===45?p|=c.LAST_BOUNDARY:d=0;else if(d-1===s.length)if(p&c.PART_BOUNDARY){if(d=0,_===10){p&=~c.PART_BOUNDARY,x(`onPartEnd`),x(`onPartBegin`),f=o.HEADER_FIELD_START;break}}else p&c.LAST_BOUNDARY&&_===45?(x(`onPartEnd`),f=o.END,p=0):d=0;if(d>0)a[d-1]=_;else if(i>0){let e=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);x(`onPartData`,0,i,e),i=0,y(`onPartData`),t--}break;case o.END:break;default:throw Error(`Unexpected state entered: ${f}`)}S(`onHeaderField`),S(`onHeaderValue`),S(`onPartData`),this.index=d,this.state=f,this.flags=p}end(){if(this.state===o.HEADER_FIELD_START&&this.index===0||this.state===o.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==o.END)throw Error(`MultipartParser.end(): stream ended unexpectedly`)}};r(d,`MultipartParser`);let f=d;function p(e){let t=e.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;let n=t[2]||t[3]||``,r=n.slice(n.lastIndexOf(`\\`)+1);return r=r.replace(/%22/g,`"`),r=r.replace(/&#(\d{4});/g,(e,t)=>String.fromCharCode(t)),r}r(p,`_fileName`);async function m(e,t){if(!/multipart/i.test(t))throw TypeError(`Failed to fetch`);let n=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw TypeError(`no or bad content-type header, no multipart boundary`);let a=new f(n[1]||n[2]),o,s,c,l,u,d,m=[],h=new i.FormData,g=r(e=>{c+=b.decode(e,{stream:!0})},`onPartData`),_=r(e=>{m.push(e)},`appendToFile`),v=r(()=>{let e=new i.File(m,d,{type:u});h.append(l,e)},`appendFileToFormData`),y=r(()=>{h.append(l,c)},`appendEntryToFormData`),b=new TextDecoder(`utf-8`);b.decode(),a.onPartBegin=function(){a.onPartData=g,a.onPartEnd=y,o=``,s=``,c=``,l=``,u=``,d=null,m.length=0},a.onHeaderField=function(e){o+=b.decode(e,{stream:!0})},a.onHeaderValue=function(e){s+=b.decode(e,{stream:!0})},a.onHeaderEnd=function(){if(s+=b.decode(),o=o.toLowerCase(),o===`content-disposition`){let e=s.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);e&&(l=e[2]||e[3]||``),d=p(s),d&&(a.onPartData=_,a.onPartEnd=v)}else o===`content-type`&&(u=s);s=``,o=``};for await(let t of e)a.write(t);return a.end(),h}r(m,`toFormData`),exports.toFormData=m}));Object.defineProperty(exports,`default`,{enumerable:!0,get:function(){return n()}});
//# sourceMappingURL=multipart-parser-BN8yOPYp.js.map